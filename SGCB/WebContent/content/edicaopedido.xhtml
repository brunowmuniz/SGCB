<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

	<ui:composition template="../template/template.xhtml">
		<ui:define name="conteudo">
			<h:form>
				<p:panel header="Edição de Pedido">
					<h:panelGrid columns="5">
						<p:outputLabel for="numpedido" value="Nº Pedido: "/>
						<h:outputText value="#{pedidoControl.pedido.id}" id="numpedido" styleClass="negrito"/>
						<p:spacer width="40px"/>
						<p:outputLabel for="fornecedor" value="Fornecedor: "/>
						<h:outputText value="#{pedidoControl.pedido.fornecedor.nome}" id="fornecedor" styleClass="negrito"/>
												
						<p:outputLabel for="datapedido" value="Data de Solicitação: "/>
						<h:outputText value="#{pedidoControl.pedido.datasolicitacao}" id="datapedido" styleClass="negrito">
							<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy"/>
						</h:outputText>
						<p:spacer width="40px"/>
						<p:outputLabel for="datachegada" value="Data de Chegada: "/>
						<h:outputText value="#{pedidoControl.pedido.datachegada}" id="datachegada" styleClass="negrito">
							<f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy"/>
						</h:outputText>
						<p:commandLink value="Adicionar Produto" id="btnbuscaproduto" oncomplete="modalbuscaproduto.show()" action="#{ocProdutoControl.limparOcProduto}" actionListener="#{ocProdutoControl.limparProduto}" update="modalbuscaproduto" process="@this"/> <br />
						<p:spacer width="10px"/>									
						<p:dialog widgetVar="modalbuscaproduto" header="Buscar Produto" resizable="false" id="modalbuscaproduto">
							<p:outputPanel id="updProduto">									
								<h:panelGrid id="dadosproduto">
									<h:panelGrid columns="3">
										<p:outputLabel for="buscaproduto" value="Código/Nome: "/>
										<p:autoComplete id="buscaproduto" value="#{ocProdutoControl.ocproduto.produto}" minQueryLength="3"
																completeMethod="#{produtoControl.buscaProdutoCodigoNome}"											 
																forceSelection="true"  converter="converter.ProdutoConverter"
																var="produto" itemValue="#{produto}" itemLabel="#{produto.fornecedor.nome} - #{produto.descricao}">
											<p:ajax event="itemSelect" update="dadosproduto" process="@this" />
										</p:autoComplete>																						
										<p:commandButton value="Limpar" actionListener="#{ocProdutoControl.limparOcProduto}" update="dadosproduto" id="limparproduto" disabled="#{ocProdutoControl.ocproduto.produto.id == null}" process="@this,dadosproduto" />											
									</h:panelGrid>									
									<h:panelGrid columns="2" id="descproduto">																					
										<p:outputLabel for="codigoproduto" value="Código: " />
										<p:inputText disabled="#{ocProdutoControl.ocproduto.produto.id != null}" value="#{ocProdutoControl.ocproduto.produto.codigo}" id="codigoproduto"/>
										
										<p:outputLabel for="nomeproduto" value="Nome: " />
										<p:inputText disabled="#{ocProdutoControl.ocproduto.produto.id != null}" value="#{ocProdutoControl.ocproduto.produto.descricao}" id="nomeproduto"/>
										
										<p:outputLabel for="nomefornecedor" value="Fornecedor: " />
										<p:inputText disabled="#{ocProdutoControl.ocproduto.produto.id != null}" value="#{ocProdutoControl.ocproduto.produto.fornecedor.nome}" id="nomefornecedor" rendered="#{ocProdutoControl.ocproduto.produto.id != null}"/>
										<p:selectOneMenu value="#{ocProdutoControl.ocproduto.produto.fornecedor.id}" rendered="#{ocProdutoControl.ocproduto.produto.id == null}">
											<f:selectItem itemValue="0" itemLabel="Selecione Fornecedor" noSelectionOption="true"/>							
											<f:selectItems value="#{fornecedoresControl.listaFornecedorCombo}"/>																									
										</p:selectOneMenu>
										
										<p:outputLabel for="valorsugerido" value="Valor sugerido: " />
										<p:inputText disabled="#{ocProdutoControl.ocproduto.produto.id != null}" value="#{ocProdutoControl.ocproduto.produto.valorsugerido}" id="valorsugerido">
											<f:convertNumber locale="pt_BR" maxFractionDigits="2" maxIntegerDigits="6" minFractionDigits="2" minIntegerDigits="1"/>
											<p:ajax event="blur" process="@this" update="@this"/>
										</p:inputText>
										
										<p:outputLabel value="Showroom: " />
										<p:inputText disabled="true" value="#{ocProdutoControl.ocproduto.produto.showroom}" id="qtdeshowroomvis" rendered="#{ocProdutoControl.ocproduto.produto.id != null}"/>
										<p:spinner value="#{ocProdutoControl.ocproduto.produto.showroom}" required="true" id="qtdeshowroomedit" max="999" min="0" rendered="#{ocProdutoControl.ocproduto.produto.id == null}">
											<f:validateBean/>
											<f:convertNumber maxIntegerDigits="3"/>
										</p:spinner>
										
										<p:outputLabel value="Estoque: " />
										<p:inputText disabled="true" value="#{ocProdutoControl.ocproduto.produto.estoque}" id="qtdeestoquevis" rendered="#{ocProdutoControl.ocproduto.produto.id != null}"/>
										<p:spinner value="#{ocProdutoControl.ocproduto.produto.estoque}" required="true" id="qtdeestoqueedit" max="999" min="0" rendered="#{ocProdutoControl.ocproduto.produto.id == null}">
											<f:validateBean/>
											<f:convertNumber maxIntegerDigits="3"/>
										</p:spinner>
										
										<p:outputLabel value="Encomenda: " />
										<p:inputText disabled="true" value="#{ocProdutoControl.ocproduto.produto.encomenda}" id="qtdeencomendavis" rendered="#{ocProdutoControl.ocproduto.produto.id != null}"/>
										<p:spinner value="#{ocProdutoControl.ocproduto.produto.encomenda}" required="true" id="qtdeencomendaedit" max="999" min="0" rendered="#{ocProdutoControl.ocproduto.produto.id == null}">
											<f:validateBean/>
											<f:convertNumber maxIntegerDigits="3"/>
										</p:spinner>
										<p:outputLabel for="tiposaida" value="Tipo de Saída: "/>
										<p:selectOneMenu value="#{ocProdutoControl.ocproduto.tiposaida}" id="tiposaida" size="1">
											<p:ajax event="change" process="@this"/>
											<f:selectItem noSelectionOption="true" itemLabel="Escolha uma Saída"/>
											<f:selectItem itemValue="estoque" itemLabel="Estoque" itemDisabled="#{ocProdutoControl.ocproduto.produto.estoque == 0}"/>
											<f:selectItem itemValue="showroom" itemLabel="Showroom" itemDisabled="#{ocProdutoControl.ocproduto.produto.showroom == 0}" />
											<f:selectItem itemValue="encomenda" itemLabel="Encomenda" />
										</p:selectOneMenu>
										
										<p:outputLabel for="quantidade" value="Quantidade: " />
										<p:spinner  value="#{ocProdutoControl.ocproduto.quantidade}" id="quantidade" immediate="true" min="1" max="999">
											<f:validateBean />
											<p:ajax event="change"  process="@this,valortotal,tiposaida" update="valortotal,tiposaida" />
											<p:ajax event="blur"  process="@this,valortotal,tiposaida" update="valortotal,tiposaida" />
										</p:spinner>
										
										<p:outputLabel for="valorunitario" value="Valor Unitário: " />
										<p:inputText value="#{ocProdutoControl.ocproduto.valorunitario}" id="valorunitario" immediate="true" >
											<p:ajax event="blur"  process="@this,valortotal" update="valorunitario,valortotal" />
											<f:convertNumber locale="pt_BR" maxFractionDigits="2" maxIntegerDigits="6" minFractionDigits="2" minIntegerDigits="1"/>												
										</p:inputText>											
									
										<p:outputLabel for="valortotal" value="Valor Total: " />
										<p:inputText value="#{ocProdutoControl.ocproduto.valortotal}" id="valortotal">
											<f:convertNumber locale="pt_BR" maxFractionDigits="2" maxIntegerDigits="6" minFractionDigits="2" minIntegerDigits="1" />		
										</p:inputText>																																	
										
										<p:commandButton value="Insere Produto" actionListener="#{ocControl.adicionarProdutoOc(ocProdutoControl.ocproduto)}" 
														 onclick="modalbuscaproduto.hide()"
														 action="#{ocProdutoControl.limparOcProduto}" rendered="#{ocProdutoControl.ocproduto.produto.id != null}"/>
														 
										<p:commandButton value="Insere Produto/OC"  actionListener="#{ocControl.gravarProdutoAdicionaOc(ocProdutoControl.ocproduto)}" 
														 onclick="modalbuscaproduto.hide()"	
														 action="#{ocProdutoControl.limparOcProduto}" rendered="#{ocProdutoControl.ocproduto.produto.id == null}"/>
										
									</h:panelGrid>
								</h:panelGrid>
							</p:outputPanel>
						</p:dialog>
					</h:panelGrid>
					<p:dataTable value="#{pedidoControl.pedido.pedidoprodutos}" var="produtos">
						<p:column headerText="OC">
                 			<h:outputText value="#{produtos.ocproduto.oc.id}" />
                 		</p:column>
                 		<p:column headerText="Data da Compra">
                 			<h:outputText value="#{produtos.ocproduto.oc.datalancamento}">
                 				<f:convertDateTime pattern="dd/MM/yyyy" locale="pt_BR" />
                 			</h:outputText>
                 		</p:column>
                 		<p:column headerText="Cód. Produto">
                 			<h:outputText value="#{produtos.produto.codigo}" />
                 		</p:column>
                 		<p:column headerText="Produto">
                 			<h:outputText value="#{produtos.produto.descricao}" />
                 		</p:column>
                 		<p:column headerText="Fornecedor">
                 			<h:outputText value="#{produtos.produto.fornecedor.nome}" />
                 		</p:column>
                 		<p:column headerText="Quantidade">
                 			<h:outputText value="#{produtos.quantidade}" />
                 		</p:column>
					</p:dataTable>
				</p:panel>
			</h:form>			
		</ui:define>
		<ui:define name="rodape">
			<p:panel header="Descritivo Tela" styleClass="rodape">
	    		<p:outputLabel value="Tela de edição de pedidos." styleClass="rodape_esquerda"/>
	    		<p:outputLabel value="edicaopedido.jsf" styleClass="rodape_direita"/>
	    	</p:panel>
		</ui:define>
	</ui:composition>
</html>